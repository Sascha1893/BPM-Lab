<!-- WebShopMain BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Sun Nov 13 16:26:07 CET 2016 -->
<bpel:process name="WebShopMain"
	targetNamespace="http://iaas.uni-stuttgart.de/labs/FlowSOG"
	suppressJoinFailure="yes" xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:ns1="http://www.w3.org/2001/XMLSchema"
	xmlns:ns2="http://iaas.uni-stuttgart.de/labs/FlowSOG/Customer">

	<!-- Import the client WSDL -->

	<bpel:import namespace="http://iaas.uni-stuttgart.de/labs/FlowSOG"
		location="WebShopMainArtifacts.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://iaas.uni-stuttgart.de/labs/FlowSOG"
		location="BPMLabServices.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="ns:WebShopMain"
			myRole="WebShopMainProvider" partnerRole="WebShopMainProvider" />




		<bpel:partnerLink name="InventoryServicePartner"
			partnerLinkType="tns:InventoryServicePartner" partnerRole="InventoryProvider"></bpel:partnerLink>

		<bpel:partnerLink name="OrderServicePartner"
			partnerLinkType="tns:OrderServicePartner" partnerRole="OrderProvider"></bpel:partnerLink>
		<bpel:partnerLink name="ShipmentServicePartner"
			partnerLinkType="tns:ShipmentServicePartner" partnerRole="ShipmentProvider"></bpel:partnerLink>
		<bpel:partnerLink name="PaymentServicePartner"
			partnerLinkType="tns:PaymentServicePartner" partnerRole="PaymentProvider"></bpel:partnerLink>


	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="inputOrder" messageType="ns:WebShopMainRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="outputOrder" messageType="ns:WebShopMainResponseMessage" />
		<bpel:variable name="ListItemsPartnerResponse"
			messageType="ns:listProductsOutput">
		</bpel:variable>
		<bpel:variable name="ListItemsPartnerRequest"
			messageType="ns:listProductsInput">
		</bpel:variable>

		<bpel:variable name="CheckVorhandenResponse"
			messageType="ns:checkAvailabilityOutput"></bpel:variable>
		<bpel:variable name="CheckVorhandenRequest" messageType="ns:checkAvailabilityInput"></bpel:variable>










		<bpel:variable name="StoreOrderRequest" messageType="ns:storeOrderDetailsInput"></bpel:variable>
		<bpel:variable name="StoreOrderResponse" messageType="ns:storeOrderDetailsOutput"></bpel:variable>
		<bpel:variable name="OrderServicePartnerResponse"
			messageType="tns:calcOrderCostsOutput"></bpel:variable>
		<bpel:variable name="OrderServicePartnerRequest"
			messageType="tns:calcOrderCostsInput"></bpel:variable>
		<bpel:variable name="ShipmentServicePartnerResponse"
			messageType="tns:calcShipmentCostsOutput"></bpel:variable>
		<bpel:variable name="ShipmentServicePartnerRequest"
			messageType="tns:calcShipmentCostsInput"></bpel:variable>
		<bpel:variable name="PaymentServicePartnerResponse"
			messageType="tns:calcTransactionCostsOutput"></bpel:variable>
		<bpel:variable name="PaymentServicePartnerRequest"
			messageType="tns:calcTransactionCostsInput"></bpel:variable>
		<bpel:variable name="PaymentServicePartnerResponse1"
			messageType="tns:conductPaymentOutput"></bpel:variable>
		<bpel:variable name="PaymentServicePartnerRequest1"
			messageType="tns:conductPaymentInput"></bpel:variable>
		<bpel:variable name="ShipmentServicePartnerResponse1"
			messageType="tns:shipProductsOutput"></bpel:variable>
		<bpel:variable name="ShipmentServicePartnerRequest1"
			messageType="tns:shipProductsInput"></bpel:variable>


        
        
        <bpel:variable name="maxDate" type="ns1:date">
            <bpel:from>
                <bpel:literal xml:space="preserve"><![CDATA[]]></bpel:literal>
            </bpel:from>
        </bpel:variable>
    </bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main"><!-- Receive input from requester. Note: 
			This maps to operation defined in WebShopMain.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			createInstance="yes" operation="process" portType="ns:WebShopMain"
			variable="inputOrder" />

		<!-- Generate reply to synchronous request -->




















		<bpel:assign validate="no" name="AssignCheckVorhanden">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<FlowSOG:checkAvailability
							xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<FlowSOG:productId>FlowSOG:productId</FlowSOG:productId>
						</FlowSOG:checkAvailability>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="CheckVorhandenRequest" part="checkAvailabilityInput"></bpel:to>
			</bpel:copy>





            
            
            
            <bpel:copy>
                <bpel:from>
                    <![CDATA[string('2016-10-16')]]>
                </bpel:from>
                <bpel:to variable="maxDate"></bpel:to>
            </bpel:copy>
        </bpel:assign>
		<bpel:forEach parallel="no" counterName="Counter"
			name="ForEachProductinProductList">
			<bpel:startCounterValue><![CDATA[1]]></bpel:startCounterValue>
			<bpel:finalCounterValue><![CDATA[count($inputOrder.payload/tns:inputOrder/tns:products/tns:product)]]></bpel:finalCounterValue>
			<bpel:scope>
				<bpel:sequence>

					<bpel:assign validate="no"
						name="AssignProductIDForCheckVorhanden">



						<bpel:copy>
							<bpel:from>
								<bpel:literal>
									<FlowSOG:checkAvailability
										xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG"
										xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<FlowSOG:productId>FlowSOG:productId</FlowSOG:productId>
									</FlowSOG:checkAvailability>
								</bpel:literal>
							</bpel:from>
							<bpel:to variable="CheckVorhandenRequest" part="checkAvailabilityInput"></bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="inputOrder">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[tns:inputOrder/tns:products/tns:product[round($Counter)]/tns:productId]]>
								</bpel:query>
							</bpel:from>
							<bpel:to part="checkAvailabilityInput" variable="CheckVorhandenRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[ns:productId]]>
								</bpel:query>
							</bpel:to>

						</bpel:copy>

					</bpel:assign>

					<bpel:invoke name="InvokeCheckVorhanden" partnerLink="InventoryServicePartner"
						operation="checkAvailability" inputVariable="CheckVorhandenRequest"
						outputVariable="CheckVorhandenResponse"></bpel:invoke>
					<bpel:if name="IFProductNichtVorhanden">
						<bpel:condition><![CDATA[$CheckVorhandenResponse.checkAvailabilityOutput/ns:product/ns:status/ns:currentAvailability ="not available"]]></bpel:condition>
						<bpel:sequence name="Gewinnoptimierung">




                            <bpel:if name="IFDelaySmaller3Days">
                                <bpel:condition><![CDATA[$CheckVorhandenResponse.checkAvailabilityOutput/tns:product/tns:status/tns:availableAgainInDays <= 3]]></bpel:condition>
                                <bpel:sequence>
                                    
                                    <bpel:assign validate="no" name="AssignDaystoShippingDate"><bpel:copy><bpel:from><bpel:literal><FlowSOG:shipProducts xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:orderId>FlowSOG:orderId</FlowSOG:orderId>
  <FlowSOG:date>2001-01-01</FlowSOG:date>
</FlowSOG:shipProducts>
</bpel:literal></bpel:from>
                                        <bpel:to variable="ShipmentServicePartnerRequest1" part="shipProductsInput"></bpel:to>
                                    
                                        </bpel:copy>
                                
                                            <bpel:copy>
                                                <bpel:from variable="maxDate"></bpel:from>
                                                <bpel:to part="payload" variable="inputOrder">
                                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:inputOrder/tns:date]]></bpel:query>
                                            </bpel:to>
                                            </bpel:copy>
                                            
                                        
                                    
                                    </bpel:assign>
                                    
                                    
                                </bpel:sequence>
                                <bpel:else>
                                    <bpel:sequence>
                                        <bpel:assign validate="no" name="AssignStatusProductNichtVorhanden">

								<bpel:copy>
									<bpel:from>
										<bpel:literal>
											<tns:WebShopMainResponse xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												<tns:outputOrder>tns:outputOrder</tns:outputOrder>
											</tns:WebShopMainResponse>
										</bpel:literal>
									</bpel:from>
									<bpel:to variable="outputOrder" part="payload"></bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        <![CDATA[concat('Product ',string($CheckVorhandenResponse.checkAvailabilityOutput/tns:product/tns:name),' is not available. It will be available again in ', string($CheckVorhandenResponse.checkAvailabilityOutput/tns:product/tns:status/tns:availableAgainInDays),' Days')]]>
									</bpel:from>
									<bpel:to part="payload" variable="outputOrder">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                            <![CDATA[tns:outputOrder]]>
										</bpel:query>
									</bpel:to>
								</bpel:copy>


							</bpel:assign>
                                        <bpel:reply name="replyCustomer" partnerLink="client" operation="process" portType="tns:WebShopMain" variable="outputOrder"></bpel:reply>
                                        <bpel:exit name="Exit"></bpel:exit>
                                    </bpel:sequence>
                                </bpel:else>
                            </bpel:if>
                            



							

							
						</bpel:sequence>
                    </bpel:if>
				</bpel:sequence>

			</bpel:scope>
		</bpel:forEach>





        <bpel:assign validate="no" name="AssignToStoreOrder"><bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><FlowSOG:storeOrderDetails xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:customerId>sasa</FlowSOG:customerId>
  <FlowSOG:products>
    <FlowSOG:product>
      <FlowSOG:productId>44162d90-9315-4acc-980e-cf975c6b9397</FlowSOG:productId>
      <FlowSOG:numberOfItems>2</FlowSOG:numberOfItems>
    </FlowSOG:product>
  </FlowSOG:products>
  <FlowSOG:shippingAddress>FlowSOG:shippingAddress</FlowSOG:shippingAddress>
  <FlowSOG:paymentDetails>
    <FlowSOG:bankName>FlowSOG:bankName</FlowSOG:bankName>
    <FlowSOG:bankAddress>FlowSOG:bankAddress</FlowSOG:bankAddress>
    <FlowSOG:accountNumber>FlowSOG:accountNumber</FlowSOG:accountNumber>
    <FlowSOG:accountHolderName>FlowSOG:accountHolderName</FlowSOG:accountHolderName>
  </FlowSOG:paymentDetails>
  <FlowSOG:status>ordered</FlowSOG:status>
</FlowSOG:storeOrderDetails></bpel:literal>
				</bpel:from>
				<bpel:to variable="StoreOrderRequest" part="storeOrderDetailsInput"></bpel:to>
			</bpel:copy>

			<bpel:copy>
				<bpel:from part="payload" variable="inputOrder">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:inputOrder/tns:shippingAddress]]></bpel:query>
				</bpel:from>
				<bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:shippingAddress]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="inputOrder">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:inputOrder/tns:customerID]]></bpel:query>
				</bpel:from>
				<bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="inputOrder">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:inputOrder/tns:products]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:products]]></bpel:query>
				</bpel:to>
			</bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="inputOrder">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:inputOrder/tns:paymentDetails]]></bpel:query>
                </bpel:from>
                <bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:paymentDetails]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
        </bpel:assign>
        <bpel:invoke name="InvokeStoreOrder" partnerLink="OrderServicePartner" operation="storeOrderDetails" portType="tns:OrderPortType" inputVariable="StoreOrderRequest" outputVariable="StoreOrderResponse"></bpel:invoke>
        <bpel:flow name="Flow">
            <bpel:sequence name="Sequence"><bpel:assign validate="no" name="AssignCalcShipmentCosts">
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><FlowSOG:calcShipmentCosts xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:orderId>FlowSOG:orderId</FlowSOG:orderId>
</FlowSOG:calcShipmentCosts>
</bpel:literal>
				</bpel:from>
				<bpel:to part="calcShipmentCostsInput" variable="ShipmentServicePartnerRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="storeOrderDetailsOutput" variable="StoreOrderResponse">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:from>
				<bpel:to part="calcShipmentCostsInput" variable="ShipmentServicePartnerRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
                <bpel:invoke name="InvokeCalcShipmentCosts" partnerLink="ShipmentServicePartner" operation="calcShipmentCosts" inputVariable="ShipmentServicePartnerRequest" outputVariable="ShipmentServicePartnerResponse"></bpel:invoke>
            
            </bpel:sequence><bpel:sequence name="Sequence1">
                <bpel:assign validate="no" name="AssignToCalcOrder">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<FlowSOG:calcOrderCosts xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<FlowSOG:orderId>FlowSOG:orderId</FlowSOG:orderId>
						</FlowSOG:calcOrderCosts>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="OrderServicePartnerRequest" part="calcOrderCostsInput"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="storeOrderDetailsOutput" variable="StoreOrderResponse">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:from>
				<bpel:to part="calcOrderCostsInput" variable="OrderServicePartnerRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
                <bpel:invoke name="InvokeCalcOrderCosts" partnerLink="OrderServicePartner" operation="calcOrderCosts" inputVariable="OrderServicePartnerRequest" outputVariable="OrderServicePartnerResponse"></bpel:invoke>
            </bpel:sequence>
            <bpel:sequence name="Sequence2">
                <bpel:assign validate="no" name="AssignCalcTransactionCosts">
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><FlowSOG:calcTransactionCosts xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:orderId>FlowSOG:orderId</FlowSOG:orderId>
</FlowSOG:calcTransactionCosts>
</bpel:literal>
				</bpel:from>
				<bpel:to part="calcTransactionCostsInput" variable="PaymentServicePartnerRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="storeOrderDetailsOutput" variable="StoreOrderResponse">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:from>
				<bpel:to part="calcTransactionCostsInput" variable="PaymentServicePartnerRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
                <bpel:invoke name="InvokeCalcTransactionCosts" partnerLink="PaymentServicePartner" operation="calcTransactionCosts" inputVariable="PaymentServicePartnerRequest" outputVariable="PaymentServicePartnerResponse"></bpel:invoke>
            </bpel:sequence>
        
                
        </bpel:flow>
        <bpel:assign validate="no" name="AssignConductPayment">
            <bpel:copy><bpel:from>
					<bpel:literal xml:space="preserve"><FlowSOG:conductPayment xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:orderId>55</FlowSOG:orderId>
  <FlowSOG:amount>0.0</FlowSOG:amount>
</FlowSOG:conductPayment></bpel:literal>
				</bpel:from>
				<bpel:to variable="PaymentServicePartnerRequest1" part="conductPaymentInput"></bpel:to>
			
            </bpel:copy><bpel:copy>
				<bpel:from part="storeOrderDetailsOutput" variable="StoreOrderResponse">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:from>
				<bpel:to part="conductPaymentInput" variable="PaymentServicePartnerRequest1">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:orderId]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
                    
                    
                    
                    
                    
                    
                    <![CDATA[sum($OrderServicePartnerResponse.calcOrderCostsOutput/tns:orderCosts | $ShipmentServicePartnerResponse.calcShipmentCostsOutput/tns:shipmentCosts | $PaymentServicePartnerResponse.calcTransactionCostsOutput/tns:transactionCosts)]]>
				</bpel:from>
				<bpel:to part="conductPaymentInput" variable="PaymentServicePartnerRequest1">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:amount]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		
                
        </bpel:assign>
        <bpel:invoke name="InvokeConductPayment" partnerLink="PaymentServicePartner" operation="conductPayment" portType="tns:PaymentPortType" inputVariable="PaymentServicePartnerRequest1" outputVariable="PaymentServicePartnerResponse1"></bpel:invoke>
        <bpel:assign validate="no" name="AssignUpdateStatus"><bpel:copy>
                        <bpel:from part="conductPaymentOutput" variable="PaymentServicePartnerResponse1">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                
        </bpel:assign>
        <bpel:invoke name="InvokeUpdateOrderStatus" partnerLink="OrderServicePartner" operation="storeOrderDetails" portType="tns:OrderPortType" inputVariable="StoreOrderRequest" outputVariable="StoreOrderResponse"></bpel:invoke>
        <bpel:assign validate="no" name="AssignShipProducts">
            <bpel:copy><bpel:from>
					<bpel:literal xml:space="preserve"><FlowSOG:shipProducts xmlns:FlowSOG="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FlowSOG:orderId>FlowSOG:orderId</FlowSOG:orderId>
  <FlowSOG:date>2001-01-01</FlowSOG:date>
</FlowSOG:shipProducts>
</bpel:literal>
				</bpel:from>
				<bpel:to part="shipProductsInput" variable="ShipmentServicePartnerRequest1"></bpel:to>
			
            </bpel:copy><bpel:copy>
				<bpel:from part="storeOrderDetailsOutput" variable="StoreOrderResponse">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:from>
				<bpel:to part="shipProductsInput" variable="ShipmentServicePartnerRequest1">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:orderId]]></bpel:query>
				</bpel:to>
			</bpel:copy>

			<bpel:copy>
				<bpel:from part="payload" variable="inputOrder">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:inputOrder/tns:date]]></bpel:query>
				</bpel:from>
				<bpel:to part="shipProductsInput" variable="ShipmentServicePartnerRequest1">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:date]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		
                
        </bpel:assign>
        <bpel:invoke name="InvokeShipProducts" partnerLink="ShipmentServicePartner" operation="shipProducts" portType="tns:ShipmentPortType" inputVariable="ShipmentServicePartnerRequest1" outputVariable="ShipmentServicePartnerResponse1"></bpel:invoke>
        <bpel:assign validate="no" name="AssignUpdateStatus1"><bpel:copy>
                        <bpel:from part="shipProductsOutput" variable="ShipmentServicePartnerResponse1">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="storeOrderDetailsInput" variable="StoreOrderRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                
        </bpel:assign>
        <bpel:invoke name="InvokeUpdateOrderStatus1" partnerLink="OrderServicePartner" operation="storeOrderDetails" portType="tns:OrderPortType" inputVariable="StoreOrderRequest" outputVariable="StoreOrderResponse"></bpel:invoke>
        
        
        

		
        
        
        
		
		
		
		
		
		
		
		
		
		<bpel:assign validate="no" name="AssignStatusForCustomer">


			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><tns:WebShopMainResponse
						xmlns:tns="http://iaas.uni-stuttgart.de/labs/FlowSOG" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:outputOrder>tns:outputOrder</tns:outputOrder>
</tns:WebShopMainResponse>
</bpel:literal>
				</bpel:from>
				<bpel:to part="payload" variable="outputOrder"></bpel:to>

			</bpel:copy>
			<bpel:copy>
				<bpel:from>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[concat('Order with ID ', string($StoreOrderResponse.storeOrderDetailsOutput/tns:orderId),' and total costs of ', string($PaymentServicePartnerRequest1.conductPaymentInput/tns:amount), ' is payed and shipped on ', string($ShipmentServicePartnerRequest1.shipProductsInput/tns:date))]]>
				</bpel:from>
				<bpel:to part="payload" variable="outputOrder">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:outputOrder]]></bpel:query>
				</bpel:to>

			</bpel:copy>
		</bpel:assign>
		<bpel:reply name="replyOutput" partnerLink="client"
			operation="process" portType="ns:WebShopMain" variable="outputOrder" />

	</bpel:sequence>

</bpel:process>

